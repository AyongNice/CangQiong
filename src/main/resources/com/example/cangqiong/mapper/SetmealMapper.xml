<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.cangqiong.mapper.SetmealMapper">

    <insert id="addSetmeal">
        insert into setmeal (id,
                             name,
                             category_id,
                             price,
                             description,
                             image,
                             status,
                             update_time,
                             update_user,
                             create_time,
                             create_user)
        values (#{id},
                #{name},
                #{categoryId},
                #{price},
                #{description},
                #{image},
                #{status},
                #{updateTime},
                #{updateUser},
                #{createTime},
                #{createUser})
    </insert>

    <insert id="addSetmealDishes">
        insert into setmeal_dish (
        setmeal_id,
        dish_id,
        name,
        price,
        copies
        )
        values
        <foreach item="item" index="index" collection="list" open="(" separator="),(" close=")">
            #{item.setmealId}, #{item.dishId}, #{item.name}, #{item.price}, #{item.copies}
        </foreach>
    </insert>

    <select id="page" resultType="com.example.cangqiong.dto.SetmealDto">
        select t1.name,
        t1.category_id as categoryId,
        t3.name as categoryName,
        t2.name as createName,
        t1.price,
        t1.description,
        t1.image,
        t1.status,
        t1.update_time as updateTime,
        t1.update_user as updateUser,
        t1.create_time as createTime,
        t1.create_user as createUser,
        t1.id from setmeal as t1 , employee as t2, category as t3
        <where>
            <if test="name != null">
                AND t1.name LIKE CONCAT('%', #{name}, '%')
            </if>
            <if test="categoryId != null">
                AND t1.category_id = #{categoryId}
            </if>
            <if test="status != null">
                AND t1.status = #{status} AND
            </if>
            t1.create_user = t2.id AND t1.category_id = t3.id
        </where>

    </select>
</mapper>
